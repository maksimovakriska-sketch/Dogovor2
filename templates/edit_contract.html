{% extends "base.html" %}
{% block content %}
<h2>{% if contract %}Редактирование договора{% else %}Новый договор{% endif %}</h2>

<form method="post">
  {{ form.hidden_tag() }}
  <div class="row">
    <div class="col-md-6">
      <div class="mb-2">{{ form.contract_date.label }} {{ form.contract_date(class="form-control", type="date") }}</div>
      <div class="mb-2">{{ form.contract_number.label }} {{ form.contract_number(class="form-control") }}</div>
      <div class="mb-2">{{ form.contractor.label }} {{ form.contractor(class="form-control") }}</div>
      <div class="mb-2">{{ form.main_or_additional.label }} {{ form.main_or_additional(class="form-control", id="type_select") }}</div>
      <div class="mb-2" id="parent_block">{{ form.parent_contract.label }} {{ form.parent_contract(class="form-select") }}</div>
      <div class="mb-2" id="extra_type_block">{{ form.extra_type.label }} {{ form.extra_type(class="form-select", id="extra_type") }}</div>
      <div class="mb-2">{{ form.payment_type.label }} {{ form.payment_type(class="form-select") }}</div>
    </div>
    <div class="col-md-6">
      <div class="mb-2">{{ form.amount_total.label }} {{ form.amount_total(class="form-control") }}</div>
      <div class="mb-2" id="amount_paid_block">{{ form.amount_paid.label }} {{ form.amount_paid(class="form-control") }}</div>
      <div class="mb-2">{{ form.status.label }} {{ form.status(class="form-select") }}</div>
    </div>
  </div>

  <div class="mt-3">
    {{ form.submit(class="btn btn-primary") }}
    <a href="{{ url_for('main.contracts') }}" class="btn btn-secondary">Отмена</a>
  </div>
</form>

<script>
  // Простейшая логика видимости: показываем parent и extra_type только для доп. соглашения
  (function(){
    const typeSelect = document.getElementById('type_select');
    const parentBlock = document.getElementById('parent_block');
    const extraTypeBlock = document.getElementById('extra_type_block');
    const amountPaidBlock = document.getElementById('amount_paid_block');

    function updateVisibility() {
      if (!typeSelect) return;
      const isExtra = typeSelect.value === 'Доп соглашение' || typeSelect.value === 'Доп соглашение';
      parentBlock.style.display = isExtra ? 'block' : 'none';
      extraTypeBlock.style.display = isExtra ? 'block' : 'none';
      // Для доп. соглашения показываем поле "Оплачено" (чтобы можно было сразу зачесть оплату)
      amountPaidBlock.style.display = isExtra ? 'block' : 'block'; // показываем всегда, оставил видимым
    }

    document.addEventListener('DOMContentLoaded', updateVisibility);
    if (typeSelect) typeSelect.addEventListener('change', updateVisibility);
  })();
</script>
{% endblock %}